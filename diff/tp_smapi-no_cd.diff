--- orig/tp_smapi.c	2006-01-07 20:39:28.000000000 +0000
+++ no_cd_speed/tp_smapi.c	2006-01-07 21:05:56.000000000 +0000
@@ -66,2 +65,0 @@
-/* #define PROVIDE_CD_SPEED  */ /* evil - see README */
-
@@ -560,48 +557,0 @@
-#ifdef PROVIDE_CD_SPEED
-
-static int get_cd_speed(int *speed) {
-	const char* msg;
-	u32 bx, dx, di;
-	int ret = smapi_request(SMAPI_GET_CDROM_STATUS, 0, 0, 0, 
-	                        &bx, NULL, &dx, &di, NULL, &msg);
-	if (ret) {
-		printk(TP_NOTICE "cannot get cd speed: %s\n", msg);
-		return ret;
-	}
-	if (dx==0x78 && di==0x1e) {
-		*speed = 2;
-	} else if (dx==0x0f && di==0x00) {
-		*speed = 0;
-	} else {
-		*speed = 1;
-	}
-	/* what does bx&80 mean? */
-	return 0;
-}
-
-static int set_cd_speed(int speed) {
-	const char* msg;
-	int ret, dummy;
-	short int cx, di;
-	ret = get_cd_speed(&dummy); /* verify read before writing */
-	if (ret)
-		return ret;
-	if (speed==0) {
-		cx=0x0f; di=0x00;
-	} else if (speed==1) {
-		cx=0x1e; di=0x04;
-	} else {
-		cx=0x78; di=0x1e;
-	}
-	ret = smapi_write(SMAPI_SET_CDROM_STATUS, cx, di, 0, &msg);
-	if (ret)
-		printk(TP_NOTICE "cannot set cd speed to %d: %s\n", 
-		       speed, msg);
-	else
-		printk(TP_INFO "cd speed set to level %d\n",
-		       speed);
-	return ret;
-}
-
-#endif /* PROVIDE_CD_SPEED */
-
@@ -1135,35 +1084,0 @@
-#ifdef PROVIDE_CD_SPEED
-/*********************************************************************
- * Optical drive speed setting. This should be done by the ATAPI 
- * driver instead, and may get in the ATAPI driver's way.
- */
-
-static int show_cd_speed(struct device *dev, 
-                         struct device_attribute *attr, char *buf)
-{
-	int speed;
-	int ret = get_cd_speed(&speed);
-	if (ret)
-		return ret;
-	return sprintf(buf, "%d\n", speed);
-}
-
-static int store_cd_speed(struct device *dev, 
-                          struct device_attribute *attr,
-                          const char *buf, size_t count)
-{
-	int ret;
-	int speed;
-	if (sscanf(buf, "%d", &speed)<1 || speed<0 || speed>2) {
-		printk(TP_ERR "cd_speed: must be between 0 and 2\n");
-		return -EINVAL;
-	}
-	ret = set_cd_speed(speed);
-	if (ret)
-		return ret;
-	return count;
-}
-
-#endif /* PROVIDE_CD_SPEED */
-
-
@@ -1235,3 +1149,0 @@
-#ifdef PROVIDE_CD_SPEED
-static DEVICE_ATTR(cd_speed, 0644, show_cd_speed, store_cd_speed);
-#endif
@@ -1243,3 +1154,0 @@
-#ifdef PROVIDE_CD_SPEED
-	&dev_attr_cd_speed.attr,
-#endif
